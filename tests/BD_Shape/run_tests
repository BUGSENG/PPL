#!/bin/sh

# NOTE: mpq_class must be the first in the list.  See Makefile.am.
instances="mpq_class float double mpz_class int8_t int16_t int32_t int64_t"

mpz_class_XFAIL_TESTS=polydifference7
mpq_class_XFAIL_TESTS=polydifference7
int8_t_XFAIL_TESTS=polydifference7
int16_t_XFAIL_TESTS=polydifference7
int32_t_XFAIL_TESTS=polydifference7
int64_t_XFAIL_TESTS=polydifference7
float_XFAIL_TESTS=polydifference7
double_XFAIL_TESTS=polydifference7
long_double_XFAIL_TESTS=polydifference7

check_PROGRAMS=$(MAKEFLAGS='' make -s print_check_PROGRAMS)

for instance in $instances 
do
	echo "**************************** " $instance " ****************************"
	eval xfail_tests='"$'$instance'_XFAIL_TESTS"'
	[ -f dirty_marker ] && make clean
	touch dirty_marker
	make check TESTS="$check_PROGRAMS" TEST_CPPFLAGS="-DBD_SHAPE_INSTANCE=$instance" XFAIL_TESTS=$xfail_tests || exit 1
	make clean && rm dirty_marker
done
